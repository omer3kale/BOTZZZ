<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Analytics Dashboard - BOTZZZ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .header h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .nav-btn {
            padding: 10px 20px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }
        
        .stat-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 1.1em;
        }
        
        .analytics-panels {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .panel h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-container {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .service-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            border-left: 4px solid #28a745;
        }
        
        .service-name {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .service-metrics {
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .metric {
            display: flex;
            flex-direction: column;
            text-align: right;
        }
        
        .metric-value {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .metric-label {
            font-size: 0.8em;
        }
        
        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .activity-count {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .real-time-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
            margin-right: 8px;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .trend-indicator {
            font-size: 1.2em;
            margin-left: 10px;
        }
        
        .trend-up { color: #28a745; }
        .trend-down { color: #dc3545; }
        .trend-stable { color: #6c757d; }
        
        .loading {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 20px;
        }
        
        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            transform: scale(1.1) rotate(180deg);
        }
        
        .full-width-panel {
            grid-column: 1 / -1;
        }
        
        @media (max-width: 768px) {
            .analytics-panels {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Real-Time Analytics Dashboard</h1>
            <p style="text-align: center; color: #6c757d; margin-top: 10px;">
                <span class="real-time-indicator"></span>
                Comprehensive Performance Monitoring & Insights
            </p>
            <div class="nav-menu">
                <a href="{{ url_for('admin_dashboard') }}" class="nav-btn">üè† Main Dashboard</a>
                <a href="{{ url_for('ai_management') }}" class="nav-btn">ü§ñ AI Management</a>
                <a href="{{ url_for('campaign_center') }}" class="nav-btn">üì¢ Campaigns</a>
                <a href="{{ url_for('bulletproof_dashboard') }}" class="nav-btn">üõ°Ô∏è Bulletproof</a>
            </div>
        </div>

        <!-- Key Performance Indicators -->
        <div class="stats-grid" id="kpi-grid">
            <div class="stat-card">
                <div class="stat-icon">üìà</div>
                <div class="stat-value" id="total-services">--</div>
                <div class="stat-label">Active Services</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚ö°</div>
                <div class="stat-value" id="avg-response-time">--</div>
                <div class="stat-label">Avg Response Time (ms)</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-value" id="success-rate">--</div>
                <div class="stat-label">Success Rate (%)</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üî•</div>
                <div class="stat-value" id="total-requests">--</div>
                <div class="stat-label">Total Requests</div>
            </div>
        </div>

        <!-- Analytics Panels -->
        <div class="analytics-panels">
            <!-- Service Performance Panel -->
            <div class="panel">
                <h3>üöÄ Service Performance</h3>
                <div id="service-performance" class="loading">Loading service data...</div>
            </div>

            <!-- Recent Activity Panel -->
            <div class="panel">
                <h3>üìä Recent Activity</h3>
                <div id="recent-activity" class="loading">Loading activity data...</div>
            </div>

            <!-- Performance Trends Panel -->
            <div class="panel full-width-panel">
                <h3>üìà Performance Trends (7 Days)</h3>
                <div class="chart-container">
                    <div id="trends-chart">
                        <p style="color: #6c757d; font-size: 1.2em;">üìä Interactive Chart Coming Soon</p>
                        <div id="trends-data" style="margin-top: 20px;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Health Panel -->
        <div class="panel">
            <h3>üíì System Health Monitor</h3>
            <div id="system-health" class="loading">Loading system health data...</div>
        </div>
    </div>

    <!-- Refresh Button -->
    <button class="refresh-btn" onclick="refreshAllData()" title="Refresh Data">üîÑ</button>

    <script>
        let refreshInterval;
        let isLoading = false;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            refreshAllData();
            startAutoRefresh();
        });

        function startAutoRefresh() {
            // Refresh every 30 seconds
            refreshInterval = setInterval(refreshAllData, 30000);
        }

        function stopAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
        }

        async function refreshAllData() {
            if (isLoading) return;
            
            isLoading = true;
            try {
                await Promise.all([
                    loadAnalyticsData(),
                    loadSystemHealth()
                ]);
            } catch (error) {
                console.error('Error refreshing data:', error);
            } finally {
                isLoading = false;
            }
        }

        async function loadAnalyticsData() {
            try {
                const response = await fetch('/api/analytics/dashboard');
                const result = await response.json();
                
                if (result.success && result.data) {
                    updateKPIs(result.data);
                    updateServicePerformance(result.data.services || {});
                    updateRecentActivity(result.data.recent_activities || {});
                    updateTrends(result.data.trends || []);
                }
            } catch (error) {
                console.error('Error loading analytics data:', error);
                showError('analytics', 'Failed to load analytics data');
            }
        }

        async function loadSystemHealth() {
            try {
                const response = await fetch('/api/system/health');
                const result = await response.json();
                
                updateSystemHealth(result);
            } catch (error) {
                console.error('Error loading system health:', error);
                showError('system-health', 'Failed to load system health data');
            }
        }

        function updateKPIs(data) {
            const services = Object.keys(data.services || {});
            document.getElementById('total-services').textContent = services.length;
            
            // Calculate average response time
            const avgResponseTime = services.reduce((acc, service) => {
                return acc + (data.services[service].avg_response_time || 0);
            }, 0) / services.length || 0;
            
            document.getElementById('avg-response-time').innerHTML = 
                avgResponseTime.toFixed(1) + '<span class="trend-indicator trend-stable">‚Üí</span>';
            
            // Calculate overall success rate
            const avgSuccessRate = services.reduce((acc, service) => {
                return acc + (data.services[service].avg_success_rate || 0);
            }, 0) / services.length || 0;
            
            document.getElementById('success-rate').innerHTML = 
                (avgSuccessRate * 100).toFixed(1) + '<span class="trend-indicator trend-up">‚Üë</span>';
            
            // Total requests
            const totalRequests = services.reduce((acc, service) => {
                return acc + (data.services[service].data_points || 0);
            }, 0);
            
            document.getElementById('total-requests').innerHTML = 
                totalRequests.toLocaleString() + '<span class="trend-indicator trend-up">‚Üë</span>';
        }

        function updateServicePerformance(services) {
            const container = document.getElementById('service-performance');
            
            if (Object.keys(services).length === 0) {
                container.innerHTML = '<p class="loading">No service data available</p>';
                return;
            }
            
            let html = '';
            Object.entries(services).forEach(([serviceName, metrics]) => {
                const healthColor = metrics.avg_success_rate > 0.95 ? '#28a745' : 
                                  metrics.avg_success_rate > 0.85 ? '#ffc107' : '#dc3545';
                
                html += `
                    <div class="service-item" style="border-left-color: ${healthColor}">
                        <div>
                            <div class="service-name">${serviceName}</div>
                            <div style="font-size: 0.9em; color: #6c757d; margin-top: 5px;">
                                ${metrics.data_points} data points
                            </div>
                        </div>
                        <div class="service-metrics">
                            <div class="metric">
                                <span class="metric-value">${metrics.avg_response_time}ms</span>
                                <span class="metric-label">Response</span>
                            </div>
                            <div class="metric">
                                <span class="metric-value">${(metrics.avg_success_rate * 100).toFixed(1)}%</span>
                                <span class="metric-label">Success</span>
                            </div>
                            <div class="metric">
                                <span class="metric-value">${metrics.avg_throughput}</span>
                                <span class="metric-label">Throughput</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function updateRecentActivity(activities) {
            const container = document.getElementById('recent-activity');
            
            if (Object.keys(activities).length === 0) {
                container.innerHTML = '<p class="loading">No recent activity</p>';
                return;
            }
            
            let html = '';
            Object.entries(activities)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 8)
                .forEach(([activity, count]) => {
                    html += `
                        <div class="activity-item">
                            <span>${activity.replace(/_/g, ' ').toUpperCase()}</span>
                            <span class="activity-count">${count}</span>
                        </div>
                    `;
                });
            
            container.innerHTML = html;
        }

        function updateTrends(trends) {
            const container = document.getElementById('trends-data');
            
            if (trends.length === 0) {
                container.innerHTML = '<p style="color: #6c757d;">No trend data available</p>';
                return;
            }
            
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">';
            trends.slice(-7).forEach(trend => {
                html += `
                    <div style="text-align: center; padding: 15px; background: rgba(255,255,255,0.8); border-radius: 8px;">
                        <div style="font-weight: bold; color: #2c3e50;">${trend.date}</div>
                        <div style="font-size: 0.9em; color: #6c757d; margin: 5px 0;">
                            ${trend.avg_response_time}ms avg
                        </div>
                        <div style="font-size: 0.9em; color: #28a745;">
                            ${(trend.avg_success_rate * 100).toFixed(1)}% success
                        </div>
                        <div style="font-size: 0.8em; color: #6c757d;">
                            ${trend.total_requests} requests
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }

        function updateSystemHealth(healthData) {
            const container = document.getElementById('system-health');
            
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">';
            
            // Bulletproof systems
            if (healthData.bulletproof_systems) {
                Object.entries(healthData.bulletproof_systems).forEach(([system, healthy]) => {
                    const statusIcon = healthy ? '‚úÖ' : '‚ùå';
                    const statusText = healthy ? 'HEALTHY' : 'FAILED';
                    const statusColor = healthy ? '#28a745' : '#dc3545';
                    
                    html += `
                        <div class="service-item" style="border-left-color: ${statusColor}">
                            <div>
                                <div class="service-name">${system.replace('_', ' ').toUpperCase()}</div>
                            </div>
                            <div style="color: ${statusColor}; font-weight: bold;">
                                ${statusIcon} ${statusText}
                            </div>
                        </div>
                    `;
                });
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function showError(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<p style="color: #dc3545; text-align: center;">‚ùå ${message}</p>`;
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            stopAutoRefresh();
        });
    </script>
</body>
</html>
